<html>
  <div
    id="fusion"
    anchor="parent"
    class="fusion-container forge-tab"
    layout="type: verticalBox; spacing: 5"
  >
    <div
      id="fusionSelectionArea"
      class="minipanel forge-selection-area forge-selection-area--primary fusion-selection-area"
      title="Select Item For Fusion"
    >
      <div
        id="fusionSelectionGrid"
        class="forge-slot-grid UIScrollArea"
        layout="type: grid; cell-size: 36 38;flow: true"
      >
        <div *for="local item in (self.fusionItems or {})">
          <div
            class="fusion-items-to-select"
            onclick="self:handleSelectItem(item, self.fusionPrices)"
          >
            <img
              class="fusion-items-to-select-rarity"
              *if="item.imagePath"
              *image-source="item.imagePath"
              *image-clip="item.rarityClipObject"
              *border-width="1"
              *border-color="self.selectedFusionItem and self.selectedFusionItem.key == item.key and 'white' or 'transparent'"
            />

            <UIItem
              style="height: 32px; width: 32px; align-items: center"
              *item-id="item.id"
            ></UIItem>
            <img
              *if="item.tier>0"
              class="fusion-items-to-select-tier"
              src="/images/inventory/tiers-strip.png"
              *image-clip="item.clip"
            />
            <label class="fusion-items-to-select-count">{{item.count}}</label>
          </div>
        </div>
      </div>
      <div class="forge-selection-side" style="margin-left: 0px">
        <img
          class="forge-arrow-large"
          src="/images/arrows/icon-arrow-rightlarge"
        />
        <img
          class="forge-arrow-large"
          src="/images/arrows/icon-arrow-rightlarge"
        />
        <img
          class="forge-arrow-large"
          src="/images/arrows/icon-arrow-rightlarge"
        />
        <input
          class="forge-convergence-checkbox"
          type="checkbox"
          text="Convergence"
          onchange="self:onCheckChangeConvergence(event)"
        />
      </div>
      <div class="fusion-target-slot">
        <div
          *if="self.selectedFusionItemTarget"
          class="fusion-items-to-select-target"
        >
          <UIItem
            style="height: 64px; width: 64px; align-items: center"
            *item-id="self.selectedFusionItemTarget.id"
            shader="Outfit - cyclopedia-black"
          ></UIItem>
          <img
            *if="self.selectedFusionItemTarget and self.selectedFusionItemTarget.tier > 0"
            class="fusion-items-to-select-tier"
            src="/images/inventory/tiers-strip.png"
            *image-clip="self.selectedFusionItemTarget.clip"
          />
          <img
            *visible="self.selectedFusionItemTarget.id == -1"
            src="/images/ui/icon-questionmark"
            style="position: absolute; top: 10px; left: 15px"
          />
        </div>
      </div>
    </div>

    <div
      class="minipanel forge-selection-area forge-selection-area--secondary"
      focusable="false"
      title="Further Items Needed For fusion"
      style="width: 300px"
    >
      <div
        class="forge-result-placeholder"
        focusable="false"
        *visible="not self.modeFusion"
      >
        <div class="forge-required-block">
          <div class="forge-card">
            <UIItem
              *if="self.selectedFusionItem"
              class="forge-item-icon forge-card-item"
              *item-id="self.selectedFusionItem and self.selectedFusionItem.id or -1"
            ></UIItem>
            <img
              *if="self.selectedFusionItem.id == -1"
              class="forge-question-icon"
              src="/images/ui/icon-questionmark"
            />
          </div>
          <div class="forge-counter">
            <label id="fusionSelectedItemCounter" class="forge-full-width-label"
              >{{self.selectedFusionItem and self.selectedFusionItem.count or
              0}} / 1
            </label>
          </div>
        </div>

        <div class="forge-required-block" style="margin-left: 5px">
          <div class="forge-card">
            <UIItem
              id="fusionItemDust"
              class="forge-item-icon"
              style="item-id: 37160"
            ></UIItem>
          </div>
          <div class="forge-counter">
            <label
              class="forge-full-width-label"
              *color="self.fusionPlayerHasDustToNormalFusion"
              >{{self.normalDustFusion}}</label
            >
          </div>
        </div>

        <div style="width: 150px; height: 90px">
          <div class="fusion-improve-container">
            <div class="fusion-improve-container-text">
              Success Rate:
              <label
                class="fusion-improve-percent-text"
                *color="self.fusionPlayerHasExaltedCoreToImproveRateSuccess"
              >
                {{self.fusionChanceBaseLabel}}
              </label>
            </div>

            <div class="fusion-improve-button-container">
              <button
                onclick="self:onFusionImproveChanceChange(1)"
                *disabled="self.fusionDisableImproveRateSuccessButton"
              >
                {{self.fusionChanceImprovedLabel}}
              </button>
              <div class="fusion-improve-tax-container">
                <p
                  class="fusion-improve-label"
                  *color="self.fusionPlayerHasExaltedCoreToImproveRateSuccess"
                >
                  1
                </p>
                <div style="align-items: center">
                  <img src="images/icon-currency-exaltedcore" />
                </div>
              </div>
            </div>
          </div>

          <div class="fusion-improve-container" style="margin-top: 10px">
            <div class="fusion-improve-container-text">
              Tier Loss:
              <label
                *color="self.fusionPlayerHasExaltedCoreToReduceTierLoss"
                class="fusion-improve-percent-text"
              >
                {{self.fusionTierLossChanceBaseLabel}}
              </label>
            </div>

            <div class="fusion-improve-button-container">
              <button
                onclick="self:onFusionImproveChanceChange(2)"
                *disabled="self.fusionDisableReduceTierLossButton"
              >
                {{self.fusionReduceTierLossLabel}}
              </button>
              <div class="fusion-improve-tax-container">
                <p
                  class="fusion-improve-label"
                  *color="self.fusionPlayerHasExaltedCoreToReduceTierLoss"
                >
                  1
                </p>
                <div style="align-items: center">
                  <img src="images/icon-currency-exaltedcore" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        id="fusionConvergenceSection"
        anchor="parent"
        class="fusion-convergence-section"
        *visible="self.modeFusion"
        style="width: 295px; height: 90px"
      >
        <div
          id="fusionConvergenceGrid"
          class="slot-grid forge-slot-grid UIScrollArea"
          layout="type: grid; cell-size: 36 38;flow: true"
        ></div>
        <div class="forge-required-block forge-required-block--offset">
          <div class="forge-card">
            <UIItem class="forge-item-icon" style="item-id: 37160"></UIItem>
          </div>
          <div class="forge-counter">
            <label
              class="forge-full-width-label"
              *color="self.fusionPlayerHasDustToConvergenceFusion"
            >
              {{self.convergenceDustFusion}}</label
            >
          </div>
        </div>
      </div>

      <img
        class="flow-arrow"
        style="top: 35px"
        src="/images/arrows/icon-arrow-rightlarge"
      />
      <div class="fusion-result-summary">
        <UIButton
          *disabled="not self.canTryFusion"
          class="forge-action-button forge-action-button--large"
          onclick="self:onTryFusion()"
        >
          <div class="fusion-result-preview-container">
            <div class="fusion-result-preview-wrapper">
              <img
                *visible="self.selectedFusionItem.id == -1"
                src="/images/ui/icon-questionmark"
                style="position: absolute; top: 10px; left: 15px"
              />

              <div *if="self.selectedFusionItem.id ~= -1">
                <UIItem
                  style="height: 32px; width: 32px"
                  *item-id="self.selectedFusionItem.id"
                ></UIItem>
                <img
                  *if="self.selectedFusionItem.tier > 0"
                  class="fusion-items-to-select-tier"
                  src="/images/inventory/tiers-strip.png"
                  *image-clip="self.selectedFusionItem.clip"
                />
              </div>
            </div>
            <img
              class="forge-action-arrow"
              style="position: absolute; left: 40px; top: 30px"
              src="/images/arrows/icon_3arrows"
            />
            <div class="fusion-result-preview-wrapper-second">
              <img
                *visible="self.selectedFusionItemTarget.id == -1"
                src="/images/ui/icon-questionmark"
                style="position: absolute; top: 10px; left: 15px"
              />

              <div *if="self.selectedFusionItemTarget.id ~= -1">
                <UIItem
                  style="height: 32px; width: 32px"
                  *item-id="self.selectedFusionItemTarget.id"
                ></UIItem>
                <img
                  *if="self.selectedFusionItemTarget.tier > 0"
                  class="fusion-items-to-select-tier"
                  src="/images/inventory/tiers-strip.png"
                  *image-clip="self.selectedFusionItemTarget.clip"
                />
              </div>
            </div>
          </div>
          <img
            *if="self.selectedFusionItemTarget.id == -1 or not self.canTryFusion"
            class="forge-action-overlay"
            src="/images/ui/ditherpattern64"
          />
        </UIButton>
        <div anchor="prev" class="forge-result-cost">
          <div style="align-items: center; text-align: center">
            <p>{{self.fusionPrice}}</p>
            <img
              style="margin-bottom: 3px; margin-left: 2px"
              class="resource-icon"
              src="/images/game/prey/prey_gold"
            />
          </div>
        </div>
      </div>
    </div>

    <qtpanel id="fusion-info-panel" class="info-panel">
      <div anchor="parent" class="info-row">
        <label
          class="info-text"
          style="float: left"
          text="The aim of a fusion is to increase the tier of an item."
        ></label>
        <img
          class="info-icon"
          src="/images/icons/show_gui_help_grey"
          tooltip="Two items can be fused in order to increase the tier of one of them.
- The two items need to have the same name as well as the same tier and may not be imbued. In addition, further ingredients are needed.
- If a fusion attempt fails, one of the items remains unchanged.
- The tier of the second item will be reduced by one. If the item had no tier, it will be consumed.
- If a fusion attempt is successful, the tier of one of the items increases, while the second item will be consumed."
        />
      </div>
      <div class="info-row" style="height: 15px">
        <label
          class="info-text"
          style="float: left"
          text="The classification of an item defines its maximum tier."
        ></label>
        <img
          class="info-icon"
          src="/images/icons/show_gui_help_grey"
          tooltip="- Items of classification 4 can be upgraded up to tier 10.
- Items of classification 3 can be upgraded up to tier 3.
- Items of classification 2 can be upgraded up to tier 2.
- Items of classification 1 can be upgraded up to tier 1.
- Items with no classification cannot be upgraded."
        />
      </div>
      <div class="info-row" style="height: 15px">
        <label
          class="info-text"
          style="float: left"
          text="If two items are fused, you can spend exaltation cores."
        ></label>
        <img
          class="info-icon"
          src="/images/icons/show_gui_help_grey"
          tooltip="You can spend up to two exaltation cores.
- One to increase your chance of a successful fusion and/or one to grant you a chance to keep the tier of the second item.
- If the second item has tier 0, an exaltation core will reduce the chance that the item will be consumed."
        />
      </div>
      <div class="info-row" style="height: 15px">
        <label
          class="info-text"
          style="float: left"
          text="Items with a tier grant unique bonuses."
        ></label>
        <img
          class="info-icon"
          src="/images/icons/show_gui_help_grey"
          tooltip="The bonus granted by an item's tier depends on its function, with higher tiers increasing the chance of triggering these effects:
- Weapons grant a chance to deal 60% more damage.
- Armors grant a chance to fully mitigate the damage from an attack.
- Helmets grant a chance to reduce all cooldowns during combat.
- Legs grant a chance to trigger Transcendence, turning your character into an avatar for a few seconds, providing damage reduction and enhanced critical hits.
- Boots amplify the effects of other tiered items."
        />
      </div>
    </qtpanel>
  </div>
</html>
